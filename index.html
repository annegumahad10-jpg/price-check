<!DOCTYPE html>
<html>
<head>
  <title>SHEIN PRICE CHECKER 2.1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // üîπ REPLACE WITH YOUR FIREBASE CONFIG
   const firebaseConfig = {
    apiKey: "AIzaSyBLefWlbiXbzzCRsYXBt6GKocfW6ebCrYQ",
    authDomain: "shein-price.firebaseapp.com",
    projectId: "shein-price",
    storageBucket: "shein-price.firebasestorage.app",
    messagingSenderId: "493393411127",
    appId: "1:493393411127:web:cfb4e48f0a3c842afcd3b2",
    measurementId: "G-T7ZTZ52XWY"
  };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const skuRef = ref(database, "skus");

    // ---------- CLOUD SKU FUNCTIONS ----------
    window.saveSKU = function() {
      const sku = document.getElementById("sku").value.trim();
      const identity = document.getElementById("identity").value.trim();
      const applicable = document.getElementById("voucherApplicable").value;
      if (!sku || !identity) return;

      push(skuRef, { sku, identity, applicable });
      document.getElementById("sku").value = "";
      document.getElementById("identity").value = "";
    }

    window.deleteSKU = function(id) {
      remove(ref(database, "skus/" + id));
    }

    window.loadSKUs = function() {
      onValue(skuRef, (snapshot) => {
        let html = "";
        snapshot.forEach(child => {
          const data = child.val();
          html += `
            <div class="sku-item">
              <strong>SKU:</strong> ${data.sku}<br>
              <strong>Identity:</strong> ${data.identity}<br>
              <strong>Voucher:</strong> ${data.applicable}<br>
              <button onclick="deleteSKU('${child.key}')">Delete</button>
            </div>
          `;
        });
        document.getElementById("skuList").innerHTML = html;
      });
    }

    // ---------- CHECK SKU IN DATABASE ----------
    async function checkSKU(skuInput) {
      return new Promise((resolve) => {
        onValue(skuRef, (snapshot) => {
          let found = null;
          snapshot.forEach(child => {
            const data = child.val();
            if (data.sku === skuInput.trim()) {
              found = data.applicable;
            }
          });
          resolve(found);
        }, { onlyOnce: true });
      });
    }

    window.checkVoucherBySKU = async function() {
      const skuInput = document.getElementById("skuInput").value.trim();
      const outputDiv = document.getElementById("skuCheckResult");
      if (!skuInput) return;

      const result = await checkSKU(skuInput);

      if (result === "Yes") {
        outputDiv.innerHTML = `<div class="result" style="color:green">Voucher Applicable ‚úÖ</div>`;
      } else if (result === "No") {
        outputDiv.innerHTML = `<div class="result" style="color:red">Voucher Not Applicable ‚ùå</div>`;
      } else {
        outputDiv.innerHTML = `<div class="result" style="color:orange">SKU Not Found ‚ö†</div>`;
      }
    }

  </script>

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
      background: linear-gradient(135deg,#dbeafe,#f3e8ff,#ffe4ec);
    }

    .title {
      text-align: center;
      font-size: 26px;
      font-weight: bold;
      margin-bottom: 15px;
    }

    .card {
      background: white;
      padding: 25px;
      border-radius: 20px;
      max-width: 400px;
      margin: 20px auto;
      text-align: center;
    }

    input, select, button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border-radius: 12px;
      border: 1px solid #ddd;
    }

    button {
      background: #93c5fd;
      font-weight: bold;
      cursor: pointer;
    }

    .secondary-btn {
      background: #fda4af;
    }

    .result {
      margin-top: 15px;
      padding: 12px;
      background: #f5f3ff;
      border-radius: 12px;
    }

    .price {
      font-size: 20px;
      font-weight: bold;
      color: #be185d;
    }

    .sku-item {
      background: #fff0f6;
      padding: 10px;
      border-radius: 10px;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<div class="title">SHEIN PRICE CHECKER 2.1</div>
<div id="app"></div>

<script>
let roundedPayable = 0;

/* ---------- HOMEPAGE ---------- */
function showHomepage() {
  document.getElementById("app").innerHTML = `
    <div class="card">
      <button onclick="showVoucher()">Voucher Calculator</button>
      <button onclick="showPoints()">Points Only</button>
      <button class="secondary-btn" onclick="showSKU()">Cloud SKU Manager</button>
    </div>
  `;
}

/* ---------- VOUCHER CALCULATOR ---------- */
function showVoucher() {
  document.getElementById("app").innerHTML = `
    <div class="card">
      <h2>Voucher Calculator</h2>

      <input type="number" id="price" placeholder="Enter Price (if no SKU)">
      <input type="text" id="skuInput" placeholder="Enter SKU (optional)">
      <button onclick="checkVoucherBySKU()">Check SKU</button>
      <div id="skuCheckResult"></div>

      <select id="voucherType">
        <option value="70">70% OFF (Cap 410)</option>
        <option value="73">73% OFF (Cap 469)</option>
      </select>

      <button onclick="calculateVoucher()">CHECK PRICE</button>
      <div id="output"></div>

      <button class="secondary-btn" onclick="showHomepage()">HOME</button>
    </div>
  `;
}

function calculateVoucher() {
  const priceInput = parseFloat(document.getElementById("price").value);
  const type = document.getElementById("voucherType").value;

  if (isNaN(priceInput) || priceInput <= 0) return;

  let discount = type === "70"
    ? Math.min(priceInput * 0.7, 410)
    : Math.min(priceInput * 0.73, 469);

  const payable = priceInput - discount;
  roundedPayable = Math.round(payable);

  document.getElementById("output").innerHTML =
    `<div class="result"><div class="price">‚Ç±${roundedPayable}</div></div>`;
}

/* ---------- POINTS ---------- */
function showPoints() {
  document.getElementById("app").innerHTML = `
    <div class="card">
      <h2>Points Only</h2>
      <input type="number" id="poPrice" placeholder="Enter Price">
      <input type="number" id="poPoints" placeholder="Enter Points">
      <button onclick="calculatePoints()">CHECK</button>
      <div id="poOutput"></div>
      <button class="secondary-btn" onclick="showHomepage()">HOME</button>
    </div>
  `;
}

function calculatePoints() {
  const price = parseFloat(document.getElementById("poPrice").value);
  const points = parseFloat(document.getElementById("poPoints").value);
  if (isNaN(price) || price <= 0 || isNaN(points) || points < 0) return;

  const rounded = Math.round(price);
  const maxDeduction = Math.floor(rounded * 0.30);
  const actual = Math.min(points, maxDeduction);
  const final = rounded - actual;

  document.getElementById("poOutput").innerHTML =
    `<div class="result"><div class="price">‚Ç±${final}</div></div>`;
}

/* ---------- CLOUD SKU ---------- */
function showSKU() {
  document.getElementById("app").innerHTML = `
    <div class="card">
      <h2>Cloud SKU Manager</h2>
      <input type="text" id="sku" placeholder="Enter SKU">
      <input type="text" id="identity" placeholder="Enter Identity">
      <select id="voucherApplicable">
        <option value="Yes">Voucher Applicable</option>
        <option value="No">Not Applicable</option>
      </select>
      <button onclick="saveSKU()">Save SKU</button>
      <div id="skuList"></div>
      <button class="secondary-btn" onclick="showHomepage()">HOME</button>
    </div>
  `;
  loadSKUs();
}

/* ---------- START ---------- */
showHomepage();

</script>
</body>
</html>
