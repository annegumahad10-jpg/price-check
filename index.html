<!DOCTYPE html>
<html>
<head>
  <title>PRICE CHECKER 2.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // ðŸ”¹ REPLACE THIS WITH YOUR FIREBASE CONFIG
   const firebaseConfig = {
    apiKey: "AIzaSyBosH4KWheE3W_MApV8DavCqri0S-lguX4",
    authDomain: "shein-checker.firebaseapp.com",
    projectId: "shein-checker",
    storageBucket: "shein-checker.firebasestorage.app",
    messagingSenderId: "345166721183",
    appId: "1:345166721183:web:9fe89bf936f1ca139232aa",
    measurementId: "G-0R66QEB16D"
    };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const skuRef = ref(database, "skus");

    // ---------- CLOUD SKU FUNCTIONS ----------
    window.saveSKU = function() {
      const sku = document.getElementById("sku").value;
      const identity = document.getElementById("identity").value;
      const applicable = document.getElementById("voucherApplicable").value;
      if (!sku || !identity) return;

      push(skuRef, { sku, identity, applicable });
    }

    window.deleteSKU = function(id) {
      remove(ref(database, "skus/" + id));
    }

    window.loadSKUs = function() {
      onValue(skuRef, (snapshot) => {
        let html = "";
        snapshot.forEach(child => {
          const data = child.val();
          html += `
            <div class="sku-item">
              <strong>SKU:</strong> ${data.sku}<br>
              <strong>Identity:</strong> ${data.identity}<br>
              <strong>Voucher:</strong> ${data.applicable}<br>
              <button onclick="deleteSKU('${child.key}')">Delete</button>
            </div>
          `;
        });
        document.getElementById("skuList").innerHTML = html;
      });
    }
  </script>

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
      background: linear-gradient(135deg,#dbeafe,#f3e8ff,#ffe4ec);
    }

    .title {
      text-align: center;
      font-size: 26px;
      font-weight: bold;
      margin-bottom: 15px;
    }

    .card {
      background: white;
      padding: 25px;
      border-radius: 20px;
      max-width: 400px;
      margin: 20px auto;
      text-align: center;
    }

    input, select, button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border-radius: 12px;
      border: 1px solid #ddd;
    }

    button {
      background: #93c5fd;
      font-weight: bold;
      cursor: pointer;
    }

    .secondary-btn {
      background: #fda4af;
    }

    .result {
      margin-top: 15px;
      padding: 12px;
      background: #f5f3ff;
      border-radius: 12px;
    }

    .price {
      font-size: 20px;
      font-weight: bold;
      color: #be185d;
    }

    .sku-item {
      background: #fff0f6;
      padding: 10px;
      border-radius: 10px;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<div class="title">PRICE CHECKER 2.0</div>
<div id="app"></div>

<script>
let roundedPayable = 0;

/* ---------- HOMEPAGE ---------- */
function showHomepage() {
  document.getElementById("app").innerHTML = `
    <div class="card">
      <button onclick="showVoucher()">Voucher Calculator</button>
      <button onclick="showPoints()">Points Only</button>
      <button class="secondary-btn" onclick="showSKU()">Cloud SKU Manager</button>
    </div>
  `;
}

/* ---------- VOUCHER ---------- */
function showVoucher() {
  document.getElementById("app").innerHTML = `
    <div class="card">
      <h2>Voucher Calculator</h2>
      <input type="number" id="price" placeholder="Enter Price">
      <select id="voucherType">
        <option value="70">70% OFF (Cap 410)</option>
        <option value="73">73% OFF (Cap 469)</option>
      </select>
      <button onclick="calculateVoucher()">CHECK</button>
      <div id="output"></div>
      <button class="secondary-btn" onclick="showHomepage()">HOME</button>
    </div>
  `;
}

function calculateVoucher() {
  const price = parseFloat(document.getElementById("price").value);
  const type = document.getElementById("voucherType").value;
  if (isNaN(price) || price <= 0) return;

  let discount = type === "70"
    ? Math.min(price * 0.7, 410)
    : Math.min(price * 0.73, 469);

  const payable = price - discount;
  roundedPayable = Math.round(payable);

  document.getElementById("output").innerHTML =
    `<div class="result"><div class="price">â‚±${roundedPayable}</div></div>`;
}

/* ---------- POINTS ---------- */
function showPoints() {
  document.getElementById("app").innerHTML = `
    <div class="card">
      <h2>Points Only</h2>
      <input type="number" id="poPrice" placeholder="Enter Price">
      <input type="number" id="poPoints" placeholder="Enter Points">
      <button onclick="calculatePoints()">CHECK</button>
      <div id="poOutput"></div>
      <button class="secondary-btn" onclick="showHomepage()">HOME</button>
    </div>
  `;
}

function calculatePoints() {
  const price = parseFloat(document.getElementById("poPrice").value);
  const points = parseFloat(document.getElementById("poPoints").value);
  if (isNaN(price) || price <= 0 || isNaN(points) || points < 0) return;

  const rounded = Math.round(price);
  const maxDeduction = Math.floor(rounded * 0.30);
  const actual = Math.min(points, maxDeduction);
  const final = rounded - actual;

  document.getElementById("poOutput").innerHTML =
    `<div class="result"><div class="price">â‚±${final}</div></div>`;
}

/* ---------- SKU CLOUD ---------- */
function showSKU() {
  document.getElementById("app").innerHTML = `
    <div class="card">
      <h2>Cloud SKU Manager</h2>
      <input type="text" id="sku" placeholder="Enter SKU">
      <input type="text" id="identity" placeholder="Enter Identity">
      <select id="voucherApplicable">
        <option value="Yes">Voucher Applicable</option>
        <option value="No">Not Applicable</option>
      </select>
      <button onclick="saveSKU()">Save SKU</button>
      <div id="skuList"></div>
      <button class="secondary-btn" onclick="showHomepage()">HOME</button>
    </div>
  `;
  loadSKUs();
}

/* ---------- START ---------- */
showHomepage();
</script>

</body>
</html>
